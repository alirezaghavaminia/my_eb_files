easyblock = 'ConfigureMake'

name = 'Yambo'
version = '4.5.0'

homepage = 'http://www.yambo-code.org'
description = """Yambo is a FORTRAN/C code for Many-Body calculations in solid state and molecular physics.
 Yambo relies on the Kohn-Sham wavefunctions generated by two DFT public codes: abinit, and PWscf."""

toolchain = {'name': 'intel', 'version': '2019b'}
toolchainopts = {'usempi': True}

source_urls = ['https://github.com/yambo-code/%(namelower)s/archive/']
sources = ['%(version)s.tar.gz']
checksums = ['c68b2c79acc31b3d48e7edb46e4049c1108d60feee80bf4fcdc4afe4b12b6928']

dependencies = [('netCDF-Fortran', '4.5.2')]

unpack_options = '--strip-components=1'
buildininstalldir = 'True'
skipsteps = ['install']

configopts = 'FPP="ifort -E -free" CPPFLAGS="" FCFLAGS="-nofor_main" --with-blas-libs="$LIBBLAS" '
configopts += '--with-lapack-libs="$LIBLAPACK" --with-blacs-libs="$LIBBLACS" '
configopts += '--with-scalapack-libs="$LIBSCALAPACK" --with-fft-libs="$LIBFFT" '
configopts += '--with-netcdf-libs="-lnetcdff -lnetcdf" '
configopts += '--with-p2y-version=qexsd-hdf5 '

buildopts = 'all'

parallel = 1

sanity_check_paths = {
    'files': ['bin/' + _prog for _prog in ['a2y', 'p2y', 'yambo', 'yambo_kerr', 'yambo_ph', 'yambo_rt',
              'ypp', 'ypp_ph', 'ypp_rt']],
    'dirs': [],
}

moduleclass = 'phys'
